from brian import *
from time import time
nw_arch=[32,20,3]
sim_dur_ff=500.0
stdp_tau=10.0
dt_=1.0
ip_pattern_idx=[143]
stdp_gmax=100.0
conn1_init_weight=3.0
spike_times_iter_ff3d=[[[1510.0],[1510.0],[1510.0],[15.0],[15.0],[1510.0],[1510.0],[1510.0],[1510.0],[16.0],[16.0],[16.0],[1510.0],[1510.0],[1510.0],[1510.0],[1510.0],[1510.0],[1510.0],[1510.0],[1510.0],[1510.0],[14.0],[9.0],[1510.0],[18.0],[18.0],[15.0],[1510.0],[1510.0],[1510.0],[1510.0]]]
stdp2_a_step=0.1
spike_times_iter_stdp=[[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,218.0,1730.0,1750.0,1770.0,1790.0,318.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,638.0,2150.0,2170.0,698.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,53.0,78.0,94.0,1610.0,136.0,153.0,174.0,197.0,213.0,1730.0,1750.0,274.0,1790.0,313.0,1830.0,1850.0,377.0,397.0,414.0,437.0,454.0,473.0,495.0,2010.0,534.0,553.0,578.0,595.0,617.0,633.0,654.0,674.0,693.0,714.0,733.0,755.0,2270.0,796.0,814.0,2330.0,858.0,877.0,894.0,918.0,936.0,956.0,977.0,2490.0,2510.0,2530.0,1058.0,2570.0,1096.0,1116.0,1137.0,1157.0,1176.0,1196.0,1216.0,1238.0,1256.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,1397.0,1417.0,2930.0,1458.0,2970.0,1496.0],[1510.0,1530.0,53.0,78.0,94.0,1610.0,136.0,153.0,174.0,197.0,213.0,1730.0,1750.0,274.0,1790.0,313.0,1830.0,1850.0,377.0,397.0,414.0,437.0,454.0,473.0,495.0,2010.0,534.0,553.0,578.0,595.0,617.0,633.0,654.0,674.0,693.0,714.0,733.0,755.0,2270.0,796.0,814.0,2330.0,858.0,877.0,894.0,918.0,936.0,956.0,977.0,2490.0,2510.0,2530.0,1058.0,2570.0,1096.0,1116.0,1137.0,1157.0,1176.0,1196.0,1216.0,1238.0,1256.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,1397.0,1417.0,2930.0,1458.0,2970.0,1496.0],[13.0,35.0,56.0,73.0,95.0,115.0,134.0,157.0,175.0,193.0,217.0,233.0,258.0,276.0,293.0,318.0,333.0,358.0,373.0,393.0,415.0,433.0,455.0,477.0,494.0,513.0,535.0,556.0,573.0,594.0,613.0,637.0,655.0,675.0,697.0,715.0,737.0,754.0,774.0,793.0,815.0,833.0,853.0,873.0,895.0,913.0,933.0,953.0,973.0,995.0,1014.0,1034.0,1053.0,1073.0,1093.0,1113.0,1133.0,1153.0,1173.0,1193.0,1213.0,1233.0,1253.0,1276.0,1293.0,1316.0,1338.0,1354.0,1373.0,1393.0,1413.0,1435.0,1453.0,1478.0,1493.0],[16.0,34.0,1550.0,78.0,1590.0,114.0,1630.0,1650.0,1670.0,198.0,1710.0,236.0,253.0,1770.0,297.0,1810.0,336.0,353.0,378.0,398.0,1910.0,438.0,1950.0,1970.0,1990.0,517.0,2030.0,2050.0,577.0,2090.0,618.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,776.0,2290.0,2310.0,837.0,858.0,878.0,2390.0,917.0,2430.0,2450.0,978.0,995.0,1015.0,1035.0,1058.0,1077.0,2590.0,2610.0,1138.0,1158.0,2670.0,2690.0,2710.0,1237.0,2750.0,1274.0,1297.0,1313.0,1333.0,1356.0,1376.0,1398.0,1418.0,1435.0,1457.0,1473.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,257.0,1770.0,1790.0,1810.0,1830.0,357.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,1337.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,1477.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,898.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[16.0,36.0,56.0,76.0,97.0,116.0,138.0,157.0,177.0,196.0,216.0,236.0,257.0,277.0,296.0,316.0,336.0,356.0,378.0,398.0,417.0,437.0,457.0,477.0,497.0,515.0,537.0,556.0,577.0,597.0,616.0,636.0,656.0,677.0,695.0,717.0,736.0,757.0,776.0,795.0,815.0,836.0,855.0,876.0,895.0,915.0,935.0,956.0,976.0,996.0,1016.0,1036.0,1057.0,1075.0,1095.0,1115.0,1136.0,1156.0,1176.0,1195.0,1216.0,1236.0,1256.0,1276.0,1296.0,1317.0,1337.0,1356.0,1376.0,1396.0,1415.0,1436.0,1456.0,1476.0,1496.0],[16.0,36.0,56.0,76.0,97.0,116.0,138.0,157.0,177.0,196.0,216.0,236.0,257.0,277.0,296.0,316.0,336.0,356.0,378.0,398.0,417.0,437.0,457.0,477.0,497.0,515.0,537.0,556.0,577.0,597.0,616.0,636.0,656.0,677.0,695.0,717.0,736.0,757.0,776.0,795.0,815.0,836.0,855.0,876.0,895.0,915.0,935.0,956.0,976.0,996.0,1016.0,1036.0,1057.0,1075.0,1095.0,1115.0,1136.0,1156.0,1176.0,1195.0,1216.0,1236.0,1256.0,1276.0,1296.0,1317.0,1337.0,1356.0,1376.0,1396.0,1415.0,1436.0,1456.0,1476.0,1496.0],[17.0,37.0,56.0,77.0,96.0,117.0,136.0,156.0,176.0,197.0,217.0,237.0,256.0,276.0,297.0,317.0,337.0,357.0,375.0,395.0,416.0,436.0,456.0,476.0,496.0,518.0,536.0,556.0,576.0,596.0,617.0,637.0,657.0,676.0,698.0,716.0,736.0,756.0,777.0,798.0,818.0,836.0,858.0,877.0,898.0,918.0,938.0,957.0,977.0,997.0,1017.0,1037.0,1056.0,1078.0,1098.0,1118.0,1137.0,1158.0,1177.0,1198.0,1217.0,1237.0,1258.0,1277.0,1296.0,1316.0,1336.0,1357.0,1376.0,1397.0,1418.0,1437.0,1457.0,1477.0,1497.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,58.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,317.0,1830.0,1850.0,378.0,1890.0,1910.0,1930.0,1950.0,476.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,638.0,2150.0,678.0,698.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,49.0,1570.0,90.0,1610.0,133.0,150.0,171.0,1690.0,210.0,1730.0,1750.0,272.0,1790.0,308.0,1830.0,1850.0,369.0,391.0,410.0,433.0,451.0,468.0,491.0,2010.0,532.0,552.0,2070.0,590.0,2110.0,629.0,651.0,669.0,689.0,712.0,730.0,751.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,49.0,1570.0,90.0,1610.0,133.0,150.0,171.0,1690.0,210.0,1730.0,1750.0,272.0,1790.0,308.0,1830.0,1850.0,369.0,391.0,410.0,433.0,451.0,468.0,491.0,2010.0,532.0,552.0,2070.0,590.0,2110.0,629.0,651.0,669.0,689.0,712.0,730.0,751.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,53.0,1570.0,92.0,1610.0,129.0,152.0,171.0,1690.0,212.0,1730.0,1750.0,270.0,1790.0,315.0,1830.0,1850.0,374.0,391.0,412.0,429.0,451.0,476.0,491.0,2010.0,530.0,550.0,2070.0,592.0,2110.0,633.0,651.0,673.0,693.0,710.0,732.0,751.0,2270.0,2290.0,818.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,138.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,438.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,796.0,809.0,2330.0,856.0,877.0,891.0,2410.0,935.0,952.0,977.0,2490.0,2510.0,1038.0,2550.0,1078.0,1093.0,1114.0,1135.0,1156.0,1177.0,1196.0,1217.0,2730.0,1258.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,38.0,1550.0,74.0,1590.0,116.0,1630.0,1650.0,1670.0,196.0,1710.0,1730.0,1750.0,1770.0,296.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,516.0,2030.0,2050.0,578.0,2090.0,616.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,772.0,788.0,814.0,833.0,848.0,869.0,892.0,911.0,929.0,951.0,968.0,994.0,1016.0,1030.0,1051.0,1070.0,1090.0,1109.0,1129.0,1148.0,1169.0,1188.0,1208.0,1232.0,1250.0,2770.0,2790.0,2810.0,2830.0,2850.0,1378.0,1396.0,1416.0,2930.0,1454.0,2970.0,1495.0],[10.0,30.0,1550.0,69.0,1590.0,108.0,1630.0,1650.0,1670.0,188.0,1710.0,231.0,258.0,1770.0,288.0,1810.0,331.0,356.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,508.0,2030.0,2050.0,570.0,2090.0,608.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,771.0,797.0,2310.0,830.0,857.0,875.0,2390.0,912.0,937.0,2450.0,976.0,989.0,1008.0,1033.0,1052.0,1073.0,1098.0,1118.0,1137.0,1157.0,1175.0,1197.0,1216.0,1231.0,1253.0,1274.0,1295.0,1316.0,2830.0,1350.0,1369.0,1388.0,1408.0,1430.0,1449.0,2970.0,1489.0],[12.0,33.0,1550.0,78.0,1590.0,116.0,1630.0,1650.0,1670.0,196.0,1710.0,231.0,249.0,1770.0,296.0,1810.0,331.0,348.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,517.0,2030.0,2050.0,573.0,2090.0,616.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,998.0,1017.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,1269.0,1288.0,1308.0,1332.0,1352.0,1374.0,1396.0,1417.0,1432.0,1458.0,1472.0,1497.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,318.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,658.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[17.0,38.0,55.0,77.0,95.0,118.0,135.0,155.0,175.0,197.0,215.0,238.0,258.0,275.0,297.0,315.0,338.0,358.0,375.0,395.0,415.0,435.0,455.0,475.0,495.0,517.0,535.0,555.0,578.0,595.0,617.0,635.0,655.0,675.0,695.0,715.0,735.0,755.0,777.0,796.0,816.0,837.0,856.0,877.0,896.0,917.0,936.0,956.0,976.0,996.0,1017.0,1036.0,1057.0,1076.0,1096.0,1116.0,1136.0,1156.0,1176.0,1196.0,1216.0,1236.0,1256.0,1278.0,1298.0,1318.0,1338.0,1357.0,1378.0,1398.0,1418.0,1438.0,1457.0,1478.0,1498.0],[17.0,38.0,55.0,77.0,95.0,118.0,135.0,155.0,175.0,197.0,215.0,238.0,258.0,275.0,297.0,315.0,338.0,358.0,375.0,395.0,415.0,435.0,455.0,475.0,495.0,517.0,535.0,555.0,578.0,595.0,617.0,635.0,655.0,675.0,695.0,715.0,735.0,755.0,777.0,796.0,816.0,837.0,856.0,877.0,896.0,917.0,936.0,956.0,976.0,996.0,1017.0,1036.0,1057.0,1076.0,1096.0,1116.0,1136.0,1156.0,1176.0,1196.0,1216.0,1236.0,1256.0,1278.0,1298.0,1318.0,1338.0,1357.0,1378.0,1398.0,1418.0,1438.0,1457.0,1478.0,1498.0],[16.0,35.0,58.0,76.0,98.0,115.0,138.0,158.0,178.0,196.0,218.0,235.0,256.0,278.0,296.0,318.0,335.0,355.0,378.0,398.0,418.0,438.0,458.0,478.0,498.0,516.0,538.0,558.0,575.0,598.0,616.0,638.0,658.0,678.0,698.0,718.0,738.0,758.0,776.0,796.0,817.0,836.0,857.0,876.0,897.0,916.0,937.0,956.0,977.0,996.0,1016.0,1036.0,1056.0,1076.0,1097.0,1117.0,1137.0,1157.0,1176.0,1196.0,1216.0,1236.0,1257.0,1275.0,1295.0,1315.0,1335.0,1356.0,1375.0,1395.0,1416.0,1435.0,1456.0,1476.0,1496.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0],[1510.0,1530.0,1550.0,1570.0,1590.0,1610.0,1630.0,1650.0,1670.0,1690.0,1710.0,1730.0,1750.0,1770.0,1790.0,1810.0,1830.0,1850.0,1870.0,1890.0,1910.0,1930.0,1950.0,1970.0,1990.0,2010.0,2030.0,2050.0,2070.0,2090.0,2110.0,2130.0,2150.0,2170.0,2190.0,2210.0,2230.0,2250.0,2270.0,2290.0,2310.0,2330.0,2350.0,2370.0,2390.0,2410.0,2430.0,2450.0,2470.0,2490.0,2510.0,2530.0,2550.0,2570.0,2590.0,2610.0,2630.0,2650.0,2670.0,2690.0,2710.0,2730.0,2750.0,2770.0,2790.0,2810.0,2830.0,2850.0,2870.0,2890.0,2910.0,2930.0,2950.0,2970.0,2990.0]]
stdp1_a_step=0.1
conn2_init_weight=5.0
sim_dur_stdp=1500.0
#
#

k=0.571/ms/mV
a=0.13
b=-2.714
d=111.506
C=81.2
vR=-60.5*mV
vT=-34.8*mV
vPeak=42.4*mV
c=-60.0*mV
Is=0

model9pEqs= Equations('''
		dV/dt=(k*((V-vR)*(V-vT))-U+I)/(C) : volt
		dU/dt=a*((b*(V-vR)/ms/ms)-(U/ms)) : volt/second
		I : mV/ms
		''')

eqs_stdp='''
dA_pre/dt=-A_pre/tau : 1
dA_post/dt=-A_post/tau : 1
'''

simclock = Clock(dt=dt_*ms)
spikeTimes = [(i, t*ms) for i in xrange(len(spike_times_iter_stdp)) for t in spike_times_iter_stdp[i]]

inputLayer = SpikeGeneratorGroup(nw_arch[0], spikeTimes, clock=simclock)
hiddenLayer = NeuronGroup(nw_arch[1], model=model9pEqs, threshold="V>vPeak", reset="V=c;U+=d", method= "RK", clock=simclock)
outputLayer = NeuronGroup(nw_arch[2], model=model9pEqs, threshold="V>vPeak", reset="V=c;U+=d", method= "RK", clock=simclock)
hiddenLayer.V = vR 
hiddenLayer.U =0
outputLayer.V = vR 
outputLayer.U =0

conn1 = Connection(inputLayer, hiddenLayer, 'V', weight=conn1_init_weight*mV, sparseness=1)
conn2 = Connection(hiddenLayer, outputLayer, 'V', weight=conn2_init_weight*mV, sparseness=1)
tau = stdp_tau*ms
stdp1=STDP(conn1,eqs=eqs_stdp,pre='A_pre+=stdp1_a_step*mV;w+=A_post',post='A_post+=stdp1_a_step*mV;w+=A_pre',wmax=stdp_gmax*mV, clock=simclock)
stdp2=STDP(conn2,eqs=eqs_stdp,pre='A_pre+=stdp2_a_step*mV;w+=A_post',post='A_post+=stdp2_a_step*mV;w+=A_pre',wmax=stdp_gmax*mV, clock=simclock)
SMO = SpikeMonitor(outputLayer)

SMI = SpikeMonitor(inputLayer)
SM = SpikeMonitor(hiddenLayer)
VM = StateMonitor(outputLayer, 'V', record=True, clock=simclock) 

run(sim_dur_stdp*ms)

#
#
def feed_forward(spikeTimesIterList, ipPatternIdx):
	reinit(states=False)
	spikeTimes = [(i, t*ms) for i in xrange(len(spikeTimesIterList)) for t in spikeTimesIterList[i]]
	inputLayer.spiketimes=spikeTimes
	t1 = time()
	run(sim_dur_ff*ms)
	t2 = time()
	print "#$ip_pattern_idx:", ipPatternIdx
	print "$sim_time:", t2 - t1, "s"
	print "$op_layer_spike_times:"
	for i in xrange(0, nw_arch[len(nw_arch)-1]):
		print " ".join(str(p) for p in SMO[i])+","

	colors=[0,0,0]
	subplot(311)
	raster_plot(SMI, title='Input Layer')
	axis([0, sim_dur_ff, 0, nw_arch[0]])
	subplot(312)
	raster_plot(SM, title='Hidden Layer')
	axis([0, sim_dur_ff, 0, nw_arch[1]])
	subplot(313)
	raster_plot(SMO, title='Output Layer')
	axis([0, sim_dur_ff, 0, nw_arch[2]])
	show()

stdp1 = None
stdp2=None
hiddenLayer.V = vR 
hiddenLayer.U =0
outputLayer.V = vR 
outputLayer.U =0
for i in xrange(0, len(spike_times_iter_ff3d)):
	feed_forward(spikeTimesIterList = spike_times_iter_ff3d[i], ipPatternIdx = ip_pattern_idx[i])
